#!/bin/bash 
#
# 1. To prepare: run 'dist' from sbt.
# 2. Run this script.
#
DATE=`date +%F`
WRAP=~/cartlc/wrap/$DATE
FILE=`ls server/play/target/universal/*.zip`
mkdir -p $WRAP
cp $FILE $WRAP/
COPY=`ls $WRAP/*.zip`

PEM=~/.ssh/cartlc.pem
SERVER="ubuntu@cartlc.arqnetworks.com"

while [[ $# -gt 0 ]]
do
	key="$1"
	case $key in
		-r)
			PEM=~/.ssh/FleetTLC.pem
			SERVER="ubuntu@ec2-13-58-198-91.us-east-2.compute.amazonaws.com"
    		shift
    	;;
		-d)
			shift
		;;
		*)
			print "Unknown opton: $key"
			exit 1;
            # unknown option
		;;
	esac
done

echo "$SERVER:"
echo "$COPY"
ssh -i $PEM $SERVER mkdir -p server/$DATE
scp -i $PEM $COPY $SERVER:/home/ubuntu/server/$DATE
ssh -i $PEM $SERVER "cd server/$DATE; unzip *.zip"

echo "UPLOAD COMPLETE."
echo "Now on the server do this:"
echo " kill-server"
echo " cd ~/server; rm -f active; ln -s $DATE active; cd .."
echo " run-server"
